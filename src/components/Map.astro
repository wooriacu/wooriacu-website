---
export interface Props {
  lat?: number
  lng?: number
  zoom?: number
  height?: string
  address?: string
}

const {
  lat = 33.9533,
  lng = -117.3962,
  zoom = 15,
  height = "300px",
  address = "3579 Arlington Ave Suite 900, Riverside, CA 92506",
} = Astro.props
---

<div class="map-container" style={`height: ${height}`}>
  <div id="map" style={`height: 100%; width: 100%;`}></div>
</div>

<script define:vars={{ lat, lng, zoom, address }}>
  // Load Leaflet CSS and JS
  const link = document.createElement("link")
  link.rel = "stylesheet"
  link.href = "https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  document.head.appendChild(link)

  const script = document.createElement("script")
  script.src = "https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  script.onload = function () {
    // Initialize the map
    const map = L.map("map").setView([lat, lng], zoom)

    // Add OpenStreetMap tiles
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution:
        'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
    }).addTo(map)

    // Add marker for the clinic location
    const marker = L.marker([lat, lng]).addTo(map)

    // Add popup with clinic information
    marker
      .bindPopup(
        `
      <div style="text-align: center; padding: 5px;">
        <strong>Woori Acupuncture</strong><br>
        ${address}<br>
        <a href="tel:+19517771011" style="color: #0066cc;">(951) 777-1011</a>
      </div>
    `
      )
      .openPopup()

    // Make map responsive
    setTimeout(() => {
      map.invalidateSize()
    }, 100)
  }
  document.head.appendChild(script)
</script>

<style>
  .map-container {
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    margin: 20px 0;
  }

  /* Ensure Leaflet controls are visible */
  .map-container :global(.leaflet-control-zoom) {
    border: none !important;
    box-shadow: 0 1px 5px rgba(0, 0, 0, 0.2) !important;
  }

  .map-container :global(.leaflet-control-zoom a) {
    background-color: white !important;
    color: #333 !important;
    border: none !important;
    width: 30px !important;
    height: 30px !important;
    line-height: 30px !important;
  }

  .map-container :global(.leaflet-control-zoom a:hover) {
    background-color: #f4f4f4 !important;
  }

  .map-container :global(.leaflet-popup-content-wrapper) {
    border-radius: 6px !important;
  }

  .map-container :global(.leaflet-popup-tip) {
    background: white !important;
  }
</style>
